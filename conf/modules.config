process {
    withName: "BATCHCORRECTION" {
        ext.args = {
                [
                    params.project_name ? "project_name:${params.project_name}" : '',
                    params.input_integration_method ? "input_integration_method:${params.input_integration_method}" : '',
                    "work_directory:\$PWD"
                ].join(' -P ').trim()
            }

    }


}

// ------------------------------------------------------------------
// FINAL OVERRIDES (keep these at the very end of nextflow.config)
// ------------------------------------------------------------------

// Lock down publish behavior for the BATCHCORRECTION process.
// We intentionally DO NOT set publishDir here â€” we want the publishDir
// defined *inside the process block* to be the single source of truth.
// This empty block is here to win precedence over anything in modules.config.
process.withName: BATCHCORRECTION {
  // leave publishDir unset here on purpose
}

// Ensure nobody resets the method via config.
// (Do NOT assign a literal here; we just assert it must be whatever the user passed.)
assert params.input_integration_method in ['all','cca','rpca','harmony','mnn'] \
  : "Invalid --input_integration_method: ${params.input_integration_method}"